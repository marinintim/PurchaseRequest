// Generated by CoffeeScript 1.4.0
(function() {

  define("Views/CreditCard", ["Views/Enchanced"], function(EnchancedView) {
    var CreditCardView;
    return CreditCardView = EnchancedView.extend({
      events: {
        "change .pr-creditcard-select": "updateToSelected",
        "keyup": "updateModel"
      },
      initialize: function(options) {
        var key, _ref,
          _this = this;
        if (options == null) {
          options = {};
        }
        this.form = {
          'cardholder': 'cardholder',
          'expiration_month': 'expire',
          'expiration_year': 'expire-year',
          'number': 'number'
        };
        for (key in this.form) {
          this.form[key] = '.pr-creditcard-form-' + this.form[key];
        }
        this.model = (_ref = options.parentModel) != null ? _ref.get("credit_card") : void 0;
        this.collection = app.collections.cards;
        this.listenToOnce(this.collection, "sync", function() {
          if (_this.collection.size() > 0) {
            _this.model.set(_this.collection.first().toJSON());
            return _this.updateToSelected({
              target: {
                value: _this.model.id
              }
            });
          }
        });
      },
      template: Handlebars.compile($("#pr-creditcard").html()),
      templateForm: Handlebars.compile($("#pr-creditcard-form").html()),
      render: function(selected) {
        if (selected == null) {
          selected = this.$(".pr-creditcard-select").val();
        }
        this.$el.html(this.template({
          cards: this.collection.toJSON()
        }));
        if (selected === "new") {
          this.$el.append(this.templateForm());
        }
        this.$('.pr-creditcard-select').val(selected);
      }
    });
  });

}).call(this);
